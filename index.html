<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SDJ Licensing System — Frontend Demo</title>
  <style>
    :root{
      --bg:#071028; --card:#0f1a34; --muted:#98a6bd; --accent:#ff8a00;
      --glass: rgba(255,255,255,0.03);
    }
    body{font-family:Inter,Segoe UI,Arial,sans-serif;background:linear-gradient(135deg,#041024 0%, #07203a 100%);color:#eaf0f8;margin:0;padding:28px}
    .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:1fr 420px;gap:18px}
    header{grid-column:1/-1;display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    .card{background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .big{padding:20px}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select,textarea,button{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:var(--glass);color:#fff;box-sizing:border-box}
    .row{display:flex;gap:8px}
    .row > *{flex:1}
    button.primary{background:linear-gradient(90deg,#ff8a00,#ffc06b);border:none;color:#041024;font-weight:600}
    small.muted{color:var(--muted);display:block;margin-top:6px}
    .list{max-height:300px;overflow:auto;margin-top:8px;padding:6px;border-radius:8px;background:rgba(255,255,255,0.02)}
    .item{padding:8px;border-bottom:1px solid rgba(255,255,255,0.02);display:flex;justify-content:space-between;gap:10px;align-items:center}
    .tag{font-size:12px;color:var(--muted)}
    .success{color:#7ef29b}
    .danger{color:#ff8a9a}
    footer{grid-column:1/-1;margin-top:12px;color:var(--muted);font-size:12px;text-align:center}
    @media (max-width:980px){.wrap{grid-template-columns:1fr} .card{margin-bottom:12px}}
  </style>
</head>
<body>
  <!--
    SDJ Licensing System — Frontend Demo
    ------------------------------------------------
    Frontend-only demo: simulates licenses using browser localStorage.
    Replace simulate* functions with real API calls to connect to a backend.
  -->

  <script>
    // === CONFIGURATION ===
    const API_BASE = ""; // empty -> uses local simulation
  </script>

  <div class="wrap">
    <header>
      <div>
        <h1>SDJ Licensing System — Frontend Demo</h1>
        <p class="lead">Static demo UI — license management and activation simulation in the browser.</p>
      </div>
      <div style="text-align:right">
        <small class="tag">Frontend-only • Demo mode</small>
      </div>
    </header>

    <!-- Public / Activation Card -->
    <section class="card big">
      <h2 style="margin-top:0">Activate / Verify License</h2>
      <label for="lic_input">License key</label>
      <input id="lic_input" placeholder="XXXX-ABCDEFGH-1234" />
      <label for="user_input">Roblox username (the player)</label>
      <input id="user_input" placeholder="player_name" />
      <label for="gameid_input">Game ID (optional)</label>
      <input id="gameid_input" placeholder="123456789" />

      <div style="margin-top:10px" class="row">
        <button class="primary" onclick="verifyLicense()">Verify / Activate</button>
        <button onclick="demoCreateSample()">Create sample license</button>
      </div>

      <div id="verify_result" style="margin-top:12px"></div>

      <small class="muted">Tip: Use the Admin panel to generate or manage licenses. This demo stores data locally in your browser.</small>
    </section>

    <!-- Admin Column -->
    <aside>
      <div class="card">
        <h3 style="margin-top:0">Admin</h3>
        <label>Admin username</label>
        <input id="admin_user" value="admin" />
        <label>Admin password</label>
        <input id="admin_pass" value="admin" type="password" />
        <div style="margin-top:8px" class="row">
          <button onclick="adminLogin()">Login</button>
          <button onclick="logoutAdmin()">Logout</button>
        </div>
        <div id="admin_msg" style="margin-top:8px;color:var(--muted)"></div>

        <hr style="border:none;height:8px">

        <div id="admin_panel" style="display:none">
          <h4>Generate Licenses</h4>
          <label>Prefix (optional)</label>
          <input id="gen_prefix" placeholder="PROMO" />
          <div class="row" style="margin-top:6px">
            <input id="gen_count" value="1" />
            <input id="gen_uses" value="1" />
            <input id="gen_days" value="0" />
          </div>
          <small class="tag">count • maxUses • expiresInDays</small>
          <div style="margin-top:8px" class="row">
            <button class="primary" onclick="generateLicenses()">Generate</button>
            <button onclick="exportData()">Export</button>
          </div>

          <h4 style="margin-top:12px">Active Licenses</h4>
          <div id="licenses_list" class="list"></div>

          <h4 style="margin-top:12px">Activations</h4>
          <div id="activations_list" class="list"></div>
        </div>
      </div>

      <div class="card" style="margin-top:12px">
        <h4>Quick actions</h4>
        <button onclick="resetDemo()">Reset demo data</button>
        <small class="muted">Clears local demo data in your browser.</small>
      </div>
    </aside>

    <footer>
      SDJ Licensing System — Frontend Demo. Replace simulated functions with a real backend to make it fully functional.
    </footer>
  </div>

  <script>
    /**********************************************************************
     * Local 'backend' simulation using localStorage.
     **********************************************************************/
    const STORAGE_KEY = "sdj_lic_demo_v1";

    function now() { return Date.now(); }
    function uid(prefix='id'){ return prefix + '_' + Math.random().toString(36).slice(2,10); }

    function loadStorage() {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (!raw) {
        const base = { licenses: [], activations: [], admin: { username: "admin", password: "admin" } };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(base));
        return base;
      }
      try { return JSON.parse(raw); } catch(e){ const base = { licenses: [], activations: [], admin: { username: "admin", password: "admin" } }; localStorage.setItem(STORAGE_KEY, JSON.stringify(base)); return base; }
    }
    function saveStorage(obj) { localStorage.setItem(STORAGE_KEY, JSON.stringify(obj)); }

    function makeKey(prefix='', length=16){
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      let s = prefix ? (prefix + '-') : '';
      for(let i=0;i<length;i++) s += chars.charAt(Math.floor(Math.random()*chars.length));
      return s.slice(0,4) + '-' + s.slice(4,8) + '-' + s.slice(8,12) + '-' + s.slice(12);
    }

    async function simulateVerifyLicense({ license, username, gameId }){
      const st = loadStorage();
      const lic = st.licenses.find(l => l.key === license);
      const nowt = now();
      if (!lic) return { valid:false, message:'License not found' };
      if (lic.revoked) return { valid:false, message:'License revoked' };
      if (lic.expiresAt && lic.expiresAt < nowt) return { valid:false, message:'License expired' };
      if (lic.maxUses && lic.uses >= lic.maxUses) return { valid:false, message:'License uses exceeded' };

      const act = { id: uid('act'), licenseKey: license, username, gameId: gameId||'', ip: '0.0.0.0', time: nowt };
      st.activations.unshift(act);
      lic.uses = (lic.uses||0) + 1;
      saveStorage(st);
      return { valid:true, message:'License verified', license:lic };
    }

    async function simulateGenerateLicenses({ count=1, prefix='', maxUses=1, expiresInDays=0, owner='' }){
      const st = loadStorage();
      const nowt = now();
      const exp = expiresInDays > 0 ? nowt + expiresInDays * 24*60*60*1000 : 0;
      const created = [];
      for(let i=0;i<count;i++){
        const key = makeKey(prefix, 16);
        const lic = { id: uid('lic'), key, owner, uses:0, maxUses: +maxUses, expiresAt: exp, revoked:0, createdAt: nowt };
        st.licenses.unshift(lic);
        created.push(lic);
      }
      saveStorage(st);
      return created;
    }

    async function simulateListLicenses(){ return loadStorage().licenses; }
    async function simulateListActivations(){ return loadStorage().activations; }
    async function simulateRevokeLicense(key){
      const st = loadStorage();
      const lic = st.licenses.find(l=>l.key===key);
      if (lic) lic.revoked = 1;
      saveStorage(st);
      return !!lic;
    }
    async function simulateDeleteLicense(key){
      const st = loadStorage();
      const before = st.licenses.length;
      st.licenses = st.licenses.filter(l=>l.key!==key);
      saveStorage(st);
      return st.licenses.length < before;
    }

    // UI bindings
    const $ = id => document.getElementById(id);
    let adminToken = null;

    function adminLogin(){
      const u = $('admin_user').value.trim();
      const p = $('admin_pass').value;
      const st = loadStorage();
      if (u === st.admin.username && p === st.admin.password){
        adminToken = 'demo-token';
        $('admin_msg').innerText = 'Logged in (demo)';
        $('admin_panel').style.display = 'block';
        refreshAdminViews();
      } else {
        $('admin_msg').innerText = 'Invalid admin credentials (demo)';
      }
    }
    function logoutAdmin(){ adminToken = null; $('admin_msg').innerText='Logged out'; $('admin_panel').style.display='none'; }

    async function verifyLicense(){
      const license = $('lic_input').value.trim();
      const username = $('user_input').value.trim();
      const gameId = $('gameid_input').value.trim();
      if (!license || !username) { showResult(false, 'License and username are required'); return; }
      const resp = await simulateVerifyLicense({ license, username, gameId });
      if (resp.valid) showResult(true, `Verified — ${resp.message}`);
      else showResult(false, resp.message);
    }

    function showResult(ok, message){
      const el = $('verify_result');
      el.innerHTML = ok ? `<div class="success">✅ ${message}</div>` : `<div class="danger">❌ ${message}</div>`;
    }

    async function demoCreateSample(){
      const created = await simulateGenerateLicenses({ count:1, prefix:'DEMO', maxUses:3, expiresInDays:7 });
      $('lic_input').value = created[0].key;
      $('user_input').value = 'DemoPlayer';
      showResult(true, 'Sample license created and filled into the form.');
      refreshAdminViews();
    }

    async function generateLicenses(){
      if (!adminToken){ alert('Login as admin first (demo)'); return; }
      const prefix = $('gen_prefix').value.trim();
      const count = Math.max(1, parseInt($('gen_count').value||1));
      const maxUses = Math.max(1, parseInt($('gen_uses').value||1));
      const days = Math.max(0, parseInt($('gen_days').value||0));
      const cr = await simulateGenerateLicenses({ count, prefix, maxUses, expiresInDays: days, owner: '' });
      alert(`Created ${cr.length} license(s). Example: ${cr[0].key}`);
      refreshAdminViews();
    }

    async function refreshAdminViews(){
      if (!adminToken) return;
      const licList = await simulateListLicenses();
      const actList = await simulateListActivations();
      const licEl = $('licenses_list'); licEl.innerHTML = '';
      licList.forEach(l=>{
        const d = document.createElement('div'); d.className='item';
        const left = document.createElement('div'); left.innerHTML = `<div><strong style="font-size:13px">${l.key}</strong></div><div class="tag">uses ${l.uses}/${l.maxUses} — ${l.revoked?'<span class="danger">revoked</span>':'<span class="success">active</span>'}</div>`;
        const right = document.createElement('div');
        right.style.minWidth='120px';
        const btnRevoke = document.createElement('button'); btnRevoke.innerText='Revoke'; btnRevoke.onclick = async ()=>{ await simulateRevokeLicense(l.key); refreshAdminViews(); };
        const btnDelete = document.createElement('button'); btnDelete.innerText='Delete'; btnDelete.onclick = async ()=>{ if(confirm('Delete?')){ await simulateDeleteLicense(l.key); refreshAdminViews(); } };
        right.appendChild(btnRevoke); right.appendChild(btnDelete);
        d.appendChild(left); d.appendChild(right);
        licEl.appendChild(d);
      });

      const actEl = $('activations_list'); actEl.innerHTML='';
      actList.forEach(a=>{
        const d = document.createElement('div'); d.className='item';
        d.innerHTML = `<div><strong>${a.username}</strong> — <span class="tag">${a.licenseKey}</span></div><div class="tag">${new Date(a.time).toLocaleString()}</div>`;
        actEl.appendChild(d);
      });
    }

    function exportData(){
      const data = localStorage.getItem(STORAGE_KEY);
      const blob = new Blob([data], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'sdj_license_demo_export.json'; document.body.appendChild(a); a.click(); a.remove();
    }

    function resetDemo(){
      if (!confirm('Reset demo data? This will clear localStorage for this demo.')) return;
      localStorage.removeItem(STORAGE_KEY);
      $('lic_input').value=''; $('user_input').value=''; $('gameid_input').value='';
      $('admin_msg').innerText='Demo reset';
      $('licenses_list').innerHTML=''; $('activations_list').innerHTML='';
    }

    (function init(){
      const st = loadStorage();
      if (st.admin){
        $('admin_user').value = st.admin.username;
        $('admin_pass').value = st.admin.password;
      }
    })();
  </script>
</body>
</html>
